<!DOCTYPE html>

<html>
<head>
<title>SARCAT - Incident Map View</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
<!--[if lte IE 8]>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.ie.css" />
<![endif]-->

<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="lib/leaflet-draw/leaflet.draw.css">
<link rel="stylesheet" type="text/css" href="lib/cilogi-marker/cilogi-marker.css">
<link rel="stylesheet" type="text/css" href="lib/sarcat.css">
<link rel="stylesheet" type="text/css" href="sarcat.css">

</head> 
<body>
		<div class="con">
			<h4>Place mission points</h4>
			<div id="button-group" class="btn-group-vertical fixed">
				<button id="ipp-button" class="btn btn-default">
					<p class="text-left">
					<span class="fa-stack">
						<i class="fa fa-fw fa-ban fa-stack-2x greenicon"></i>
						<i class="fa fa-fw fa-ban fa-stack-2x fa-flip-horizontal greenicon"></i>
					</span>
					 IPP
					</p>
				</button>
				<button id="dest-button" class="btn btn-default">
					<p class="text-left">
					<span class="fa-stack">
						<i class="fa fa-fw fa-square-o fa-stack-2x"></i>
						<span class="fa fa-fw fa-stack-1x redicon"><b>D</b></span>
					</span>
					 Destination
					</p>
				</button>
				<button id="pls-button" class="btn btn-default">
					<p class="text-left">
					<span class="fa-stack">
						<i class="fa fa-fw fa-stack-2x fa-bullseye blueicon"></i>
					</span>
					Revised PLS/LKP
					</p>
				</button>
				<button id="dot-button" class="btn btn-default">
					<p class="text-left">
					<span class="fa-stack">
						<i class="fa fa-fw fa-square-o fa-stack-2x"></i>
						<i class="fa fa-fw fa-stack-1x fa-long-arrow-up brownicon"></i>
					</span>						
					Mark Direction of Travel
					</p>
				</button>
				<button id="dp-button" class="btn btn-default">
					<p class="text-left">
					<span class="fa-stack">
						<i class="fa fa-fw fa-square-o fa-stack-2x"></i>
						<i class="fa fa-fw fa-stack-1x fa-code-fork brownicon"></i>
					</span>
					Mark Decision Point
					</p>
				</button>
                                <button id="find-button" class="btn btn-default">
                                        <p class="text-left">
                                        <span class="fa-stack">
                                                <i class="fa fa-fw fa-square-o fa-stack-2x"></i> 
                                                <span class="fa fa-stack-1x greenicon"><b>F</b></span>
                                        </span>  
                                         Mark Find
                                        </p>
                                </button>
				<button id="actualroute-button" class="btn btn-default">
					<p class="text-left">
					<span class="fa-stack">
						<i class="fa fa-fw fa-ellipsis-h"></i>
					</span>
					Show Actual Route
					</p>
				</button>
				<button id="intendedroute-button" class="btn btn-default">
					<p class="text-left">
					<span class="fa-stack">
						<i class="fa fa-fw fa-rotate-45 fa-ellipsis-v redicon"></i>
					</span>
					 Show Intended Route
					</p>
				</button>
                        <p>
                                <form id="AddressForm" class="navbar-form navbar-left" role="search">
                                        <div class="form-group">
                                                <input type="text" id="addressInput" class="form-control input-sm" placeholder="Address:  123 Any St">
                                        </div>
                                        <button type="submit" class="btn btn-default btn-sm">Go to address</button>
                                </form>
                        </p>
			</div> <!-- button-group -->

		<div id="mapwrapper" class="positionable">
			<div id="map"></div>
		</div> <!-- mapwrapper -->
	</div> <!-- container  -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" ></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
<script src="lib/leaflet-draw/leaflet.draw.js"></script>
<script src="lib/cilogi-marker/cilogi-marker.min.js"></script>

<script>
var mapmargin = 100;
$('#map').css("height", ($(window).height() - mapmargin));
$(window).on("resize", resize);
resize();

function computeSizeFromZoom() {
	var max = map.getMaxZoom(),
	zoom = map.getZoom(),
	diff = max - zoom,
	table = [4, 2, 1];
	return  (diff < table.length) ? table[diff] : 1;
}

$("#ipp-button").click(function(){
	ipp.setLatLng(map.getCenter());	
});

$("#dest-button").click(function(){
        dest.setLatLng(map.getCenter()); 
});

$("#pls-button").click(function(){
        revised.setLatLng(map.getCenter()); 
});

$("#dp-button").click(function(){
        decision.setLatLng(map.getCenter()); 
});

$("#find-button").click(function(){
        find.setLatLng(map.getCenter()); 
});


function resize(){
        $('#map').css("height", ($(window).height() - (mapmargin+12)));    
        //$('#map').css("margin-top",-21);
}

	var map = L.map('map', {
		center: new L.LatLng(39.12, -77.695),
		zoom: 5,
		maxZoom: 22,
		layers: [
			L.tileLayer('https://{s}.tiles.mapbox.com/v3/jasondalton.h4gh1idp/{z}/{x}/{y}.png', {
				maxZoom: 14,
				minZoom: 0
			}),
			L.tileLayer('http://s3-us-west-1.amazonaws.com/caltopo/topo/{z}/{x}/{y}.png', {
				minZoom: 15,
				maxZoom: 22
			})			
			]
	});

	var markers = [];

	// Rajesh
	function setcoords( obj, obj2, e)
	{
		var mark = e.target;
		var coords = mark.getLatLng();
		if( $(obj) )
			$(obj).val(coords.lat.toFixed(5));

		if( $(obj2) )
			$(obj2).val(coords.lng.toFixed(5));
	}

	var findPt = new L.latLng([99.175, -77.8]);
        find = new cilogi.L.Marker(findPt,{
		draggable: true, 
		fontIconSize: computeSizeFromZoom(),
		fontIconName: "F", // fire
		fontIconColor: "#009900",
		fontIconFont: 'awesome',
		opacity: 1
	})
	find.addTo(map);
	find.on('dragend', function(e){ 
		setcoords($("#Lat-Find_Location", top.document), $("#Lng-Find_Location", top.document), e)
		});


        var ippPt = new L.latLng([95.175, -77.7]);
        ipp = new cilogi.L.Marker(ippPt,{
                draggable: true,
                fontIconSize: computeSizeFromZoom(),
                fontIconName: "\uf00d", // fa-times
                fontIconColor: "#009900",
                fontIconFont: 'awesome',
                opacity: 1
        })
        ipp.addTo(map);
        ipp.on('dragend', function(e){
			setcoords($("#Lat-Initial_Planning_Point", top.document), $("#Lng-Initial_Planning_Point", top.document), e) 
        });



        var destPt = new L.latLng([99.175, -77.6]);
        dest = new cilogi.L.Marker(destPt,{
                draggable: true,
                fontIconSize: computeSizeFromZoom(),
                fontIconName: "D", // fire
                fontIconColor: "#990000",
                fontIconFont: 'awesome',
                opacity: 1
        })
        dest.addTo(map);
        dest.on('dragend', function(e){
			setcoords($("#Lat-Subject_Destination", top.document), $("#Lng-Subject_Destination", top.document), e) } 
        );




        var revPt = new L.latLng([99.195, -77.8]);
        revised = new cilogi.L.Marker(revPt,{
                draggable: true,
                fontIconSize: computeSizeFromZoom(),
                fontIconName: "\uf140", // fire
                fontIconColor: "#000099",
                fontIconFont: 'awesome',
                opacity: 1
        })
        revised.addTo(map);
        revised.on('dragend', function(e){
			setcoords($("#Lat-Revised_LKPPLS", top.document), $("#Lng-Revised_LKPPLS", top.document), e) 
        });


        var dotPt = new L.latLng([99.195, -77.7]);
        dot = new cilogi.L.Marker(dotPt,{
                draggable: true,
                fontIconSize: computeSizeFromZoom(),
                fontIconName: "\uf0A9", // fire
                fontIconColor: "#000000",
                fontIconFont: 'awesome',
                opacity: 1
        })
        dot.addTo(map);
        dot.on('dragend', function(e){
			//setcoords($("#Flat", top.document), $("#Flong", top.document), e)
        });


        var decPt = new L.latLng([99.195, -77.6]);
        decision = new cilogi.L.Marker(decPt,{
                draggable: true,
                fontIconSize: computeSizeFromZoom(),
                fontIconName: "\uf126", // fa-code-fork
                fontIconColor: "#A0522D",
                fontIconFont: 'awesome',
                opacity: 1
        })
        decision.addTo(map);
        decision.on('dragend', function(e){
			setcoords($("#Lat-Decision_Point", top.document), $("#Lng-Decision_Point", top.document), e) 
        });



		var drawnItems = new L.FeatureGroup();
		map.addLayer(drawnItems);

		var drawControl = new L.Control.Draw({
			draw: {
				position: 'topleft',
				polygon: false,
				circle: false,
				marker: false,
				rectangle: false,
				polyline: {
					metric: true,
					shapeOptions: {
						color: '#FF2222'
					}
				}
			},
			edit: {
				featureGroup: drawnItems
			}
		});
		map.addControl(drawControl);

		map.on('draw:created', function (e) {
			var type = e.layerType,
				layer = e.layer;

			drawnItems.addLayer(layer);
		});
		

function moveCenter(addr){
	$.getJSON("http://nominatim.openstreetmap.org/search?q="+addr.split(' ').join('+')+"&format=json", function( data ) {
		map.setView(
			new L.latLng(
				[
				parseFloat(data[0].lat),
				parseFloat(data[0].lon)
				]
			),
			13,
			{animation: true}
		);
	});
}

document.getElementById('AddressForm').addEventListener('submit', function(ev) {
	ev.preventDefault();
	var addr = document.getElementById('addressInput').value;
	moveCenter(addr);

});


</script>
</body>
</html>

